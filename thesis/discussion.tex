%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Diskussion und Ausblick
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Evaluation of the Method and Outlook}
 \label{chap:discussion}
This chapter examines the effectiveness of our best-performing model, SAC-DemoQ, on new building data. The agent utilizes the deterministic actions of a pre-trained demonstrator. First, we present the methodology and results of our evaluation process. We then discuss the performance and implications of our findings. The chapter concludes by outlining future research directions.
  
\section{Assessing Performance on New Buildings}
In the preceding sections, we presented the theoretical foundations and development of our social approach to reduce fossil energy consumption. This chapter evaluates our best-performing social method, the SAC-DemoQ, on a new set of buildings. We select the six buildings B1, B2, B4, B6, B9 and B14 (see Section~\ref{sec:building-data}), referred to as evaluation buildings. These buildings are not included in the training set to avoid overlap. We first train the RBC and SAC baseline algorithm on each building. The performance of the RBC agents is consistent across the building sets, with a slight improvement in the utilization of produced solar energy in the evaluation group. 

Figure~\ref{fig:eval-kpis} shows the KPI results of the SAC baseline agents for both the training and evaluation buildings.The agents trained for the evaluation buildings achieve better values for all KPIs than are obtained for the training buildings, except for the proportion of total renewable energy used. In particular, using battery storage in the assessment buildings enables an additional reduction in fossil energy consumption of around 1~\% compared with the training group. 

To evaluate the effectiveness of our social method, we use a pre-trained demonstrator to train SAC-DemoQ for the evaluation buildings. We use deterministic demonstrator actions and choose D6 and D11 as pre-trained demonstrators based on their correlation in energy consumption with the evaluation buildings. B11 has the highest median correlation without being part of the evaluation group, and B6 has the highest correlation within the group and performs best in the training phase when used as demonstrator. We test different ILRs to assess the need to tune this parameter.

{
\renewcommand{\baselinestretch}{0.9} 
\normalsize
\begin{figure}[htb]
\center
   \includegraphics[width=\textwidth]{figures/eval_results.pdf}
 \caption[Fossil energy consumption of the SAC-DemoQ agents trained for the evaluation buildings.]{Fossil energy consumption of the SAC-DemoQ agents trained for the evaluation buildings using different ILRs and pre-trained demonstrators with deterministic (determ.) actions.}
 \label{fig:eval-results}
\end{figure}
}

Figure~\ref{fig:eval-results} shows the mean value of the fossil energy consumption between with and without additional policy update for each experiment. Demonstrators D6 and D11 achieve the highest average saving of fossil energy using ILRs of 0.2 and 0.3, respectively. Also, the agents perform best when using D6 with a rate of 0.25 and an additional policy update. Using these parameters, the SAC-DemoQ agents save about 1~\% more fossil energy than the SAC baseline agents. The savings are thus lower than those in the training set. We also conduct these experiments using the pre-trained demonstrators D5, D14, and D16. However, they all consume slightly more fossil energy than the presented ones. 

Figure~\ref{app:social-kpis} shows the KPI results of the best-performing SAC baseline and SAC-DemoQ agents in both the training and evaluation buildings. Besides the already presented fossil energy consumption, the SAC-DemoQ agents outperform the asocial SAC agents in the three additional KPIs. However, only the improvement in the proportion of used building's solar energy is significant, i.e., greater than 0.5~\%.

{
\renewcommand{\baselinestretch}{0.9} 
\normalsize
\begin{figure}[htb]
\center
     \includegraphics[width=\textwidth]{figures/social_kpis.pdf}
  \caption[Performance of the best-performing SAC-DemoQ agents.]{Performance of the best-performing SAC-DemoQ agents trained for the training and evaluation buildings compared with the performance of the SAC baseline agents.}
  \label{app:social-kpis}
\end{figure}
}
  
\section{Final Discussion of the Results}
The evaluation of the SAC-DemoQ to reduce fossil fuel consumption shows an improvement for new buildings, with D6 leading to the most significant advancement.  However, we cannot determine any correlation between the properties of the pre-trained demonstrator and the performance of the social agents. Our analysis indicates that the demonstrator's performance, the correlation between the non-shiftable load or the correlation of the difference between solar generation and non-shiftable load are not decisive factors. Additionally, based on our findings, it is irrelevant if the demonstrator has many periods where the load exceeds the solar generation.  Further experiments with other buildings could provide more insights into this matter. 

In order to compare the benefits of our social method between the training and evaluation groups, we analyze the performance of the individual building agents. The district fossil consumption has a PCC of 0.999 to the district energy consumption across all our experiments. CityLearn provides the latter KPI and calculates the average grid energy saving per building compared with not using the battery, which is also provided on the building level. 

Figure~\ref{fig:sac-per-building} shows the energy consumption metric of the SAC baseline agents of the training and evaluation buildings, their mean value, and the standard deviation. The SAC agents in the training group perform worse on average but have a significantly lower standard deviation. This suggests that finding a suitable pre-trained demonstrator for the evaluation group may be more difficult and could explain the lower improvement of our social method during evaluation. In both the training and evaluation buildings, the only significant improvement of SAC-DemoQ agents is in saving absolute fossil energy and increasing the share of used solar energy. This indicates that the reduction in fossil energy consumption is primarily due to the more efficient use of solar energy in the buildings. Further reducing the available renewable grid energy may help investigate renewable energy savings from the grid.

{
\renewcommand{\baselinestretch}{0.9} 
\normalsize
\begin{figure}[htb]
\center
   \includegraphics[width=0.8\textwidth]{figures/building_sac.pdf}
 \caption[Comparison of the energy consumption of the SAC baseline agents between training and evaluation set.]{Comparison of the total grid energy consumption of the SAC baseline agents between the training and evaluation buildings. While the agents perform better on the evaluation buildings on average, the standard deviation is lower on the training set.}
 \label{fig:sac-per-building}
\end{figure}
}

Also, the ILR needs to be tuned for each set of buildings and each tested demonstrator. However, we conduct our experiments only once, limiting the robustness of our results. Repeating the experiments to obtain a mean performance metric could improve the robustness of our findings. Also, the forecasts used in our assessments, including weather and price forecasts, are perfect. However, this level of accuracy is also used for the baseline methods, so it is reasonable to assess the improvements achieved by our social method using these predictions.

Furthermore, our study has a limitation due to our simulation methods, which lead to lower variability in solar power generation between buildings than would occur in reality. The uniformity in simulation could create bias in the results, highlighting the necessity for a more diverse simulation of solar power generation or the use of real data in future assessments. In addition, our pre-trained demonstrators are trained on the same weather and fuel mix data as used in the training of the social agents. This consistency may positively influence our results. Hence, evaluating our method with new meteorological and fuel data for the social agents would be beneficial, allowing a better examination of the adaptability and resilience of our method. Also, experiments with more buildings would provide information about the scalability of our method. 

Finally, during the training phase, the policy loss is a reliable indicator of the final performance and stability of the social agent's performance. It is essential to mention that we categorize nuclear methods as fossil fuels for simplicity. Although they do not cause significant emissions, they remain a contentious issue, at least in Germany. Nevertheless, future research should assess them separately to evaluate emissions reduction in energy systems. 

\section{Future Research Fields}
In this chapter, we explore potential research opportunities to enhance the performance and robustness of the SAC-DemoQ method. First, we explore VS, another theory modeling the behavior of study participants in RL. Second, we examine clustering buildings, which allows for the use of customized demonstrators. Finally, we investigate the possibility of refining the ILR, which could be adaptive to improve the learning efficiency of our agents further. In addition, other approaches, such as using a different RL algorithm as a basis, are also conceivable.

\subsection{Integrating Value Shaping into SAC}
In psychology, VS adds social information from a demonstrator into the value function rather than the policy \cite{najar2020actions, witt2023social}. In SAC-DemoQ, we add a social update of the Q-networks, but only to frequency-based increase the value of observed actions. The difference in VS is to use the actual value of the demonstrator's action. An additional Q-value update in the SAC algorithm based on the method used by Najar et al. \cite{najar2020actions} could minimize the following objective:
\begin{equation}
	\small J_Q^{VS1}(\theta)=\mathbb{E}_{s_t\sim\mathcal{D}}\left[\frac{1}{2}\left ( Q_{\theta}(s_t,a_t^d) - \left(Q_{\bar{\theta}}(s_t,a_t^d) + \alpha_i Q_{\bar{\theta}}(s_t,a_t^d) \right) \right )^2 \right].
\end{equation}
In contrast to SAC-DemoQ, the Q-value of the demonstrator action in the learner is biased towards its current Q-value. In other words, if the current Q-value is high, it increases further. Conversely, if the value is already negative, it reduces.

Another way to incorporate the demonstrator value is to use the reward $r^d$ received by the demonstrator for its action. For this, the reward of the learner $r^b$ can be biased using the following formula: 
\begin{equation}
r^b = r^b + \alpha_i(r^d - r^b).
\end{equation}
If the reward of the demonstrator is greater than the reward of the learner, the final reward increases and vice versa \cite{witt2023social}. The method then uses the final reward to calculate the Q-target in the classic SAC Q-value objective. However, it is essential to consider a meaningful calculation of the reward in terms of the observed state that the demonstrator receives, as the demonstrator does not observe the same state as the learner due to the continuous spaces. It is also possible to combine VS with DB.

\subsection{Cluster Buildings to Identify Demonstrators}
Expanding our social method of reducing fossil energy consumption to more buildings up to cities is challenging since it would increase the heterogeneity of buildings, for example, in terms of load, storage capacity or solar generation patterns. This increased diversity of conditions could reduce the effectiveness of a single pre-trained demonstrator, which may not be able to handle such variability.

One way to tackle this challenge is grouping them based on key parameters that reflect their similarities and differences. These parameters may include the ratio of energy load to solar generation and storage capacity. Santamouis et al. use intelligent fuzzy clustering techniques for clustering school buildings based on their energy performance \cite{santamouris2007using}. Gao et al. identify in their dataset the occupants, operation hours, and gross area for the energy use of buildings as the most relevant features \cite{gao2014new}. Once the buildings are clustered, one can pre-train one building from each group and use this as a demonstrator for the others.

In addition, clustering enables the training of demonstrators with data sets tailored to the specific characteristics of each building group. This approach may increase the relevance of the training data, as well as enhance the adaptivity and accuracy of the pre-trained demonstrators. 

\subsection{Auto-tuning the Imitation Learning Rate}
Our experiments suggest the necessity of tuning the ILR for each building set and demonstrator. Although assigning a specific ILR for each building might enhance the performance of the agents, it is impractical to manage. One approach to this investigating which parameters significantly influence the optimal ILR. Identifying patterns or correlations between these parameters and the appropriate ILR allows developing guidelines for setting the ILR in advance. Also, as Yang et al. present, automatic hyperparameter optimization frameworks can be used \cite{yang2020hyperparameter}.

A more advanced approach is to develop adaptive systems that dynamically adjust the ILR during the training process, similar to the adjustment of entropy in the SAC algorithm. The ILR adapts based on performance indicators during training to optimize the balance between imitating the demonstrator and exploring new strategies.