%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Anhang
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

%\setcounter{secnumdepth}{-1}
\chapter{Appendix}\label{chap:App}
\section{Tables}\label{chap:App}
\begin{table}[H]
\begin{tabularx}{\linewidth}{lXc}
Attribute name & Description & Value \\ \hline
Capacity & Maximum amount of energy the storage device can store & 6.4 kWh \\
Efficiency & Technical efficiency & 90 \% \\
Capacity loss coefficient & Storage capacity lost in each charge and discharge cycle (as a fraction of the total capacity) & $1e^{-5}$ \\
Loss coefficient & Standby hourly losses & 0 \\
Nominal power & Maximum amount of electric power that the battery can use to charge or discharge & 5 \textcolor{red}{kW}
\end{tabularx}
\caption[Attributes of the batteries of each building]{Attributes of the batteries of each building. Description of the attributes obtained from \textcolor{red}{TODO source}}
\label{app:battery-attributes}
\end{table}

\begin{table}[H]
\center
\begin{tabular}{c|c}
Building Id & Energy Consumption Median 
%& Energy Consumption without storage Median & Energy Consumption without storage and PV Median 
\\  \hline
1  & 0.54 %& 0.58 & 0.81 
\\
2  & 0.45 %& 0.49 & 0.74 
\\
3  & 0.25 %& 0.28 & 0.56 
\\
4 & 0.52 %& 0.54 & 0.94  
\\
5 & 0.29 %& 0.29 & 0.74 
\\
6 & 0.5 % & 0.56 & 1.08 
\\
7 & 0.21 %& 0.21 & 0.33 
\\
8 & 0.31 %& 0.32 & 0.68 
\\
9  & 0.36 %& 0.38 & 0.46 
\\
10 & 0.56 %& 0.65 & 0.98
\\
11 & 0.66 %& 0.71 & 1.19 
\\
12 & 0.0 %& 0.0 & 0.0 
\\
13 & 0.43 %& 0.48 & 0.97 
\\
14 & 0.49 %& 0.48 & 0.59 
\\
15 & 0.12 %& 0.0 & 0.0 
\\
16 & 0.55 %& 0.72 & 1.2 
\\
17 & 0.75% & 0.82 & 1.24 \\
\end{tabular}
\caption{\textcolor{red}{Zweite Appendix-Tabelle}}
\label{tab:building-medians}
\end{table}

\begin{table}[H]
\begin{tabularx}{\linewidth}{l|X}
Name & Description \\ \hline
month & 1 (January) through 12 (December)\\
day\_type & type of day as provided by EnergyPlus (from 1 to 8). 1 (Sunday), 2 (Monday), ..., 7 (Saturday), 8 (Holiday)\\
hour & hour of day (from 1 to 24)\\
 t\_out & outdoor temperature in Celcius degrees.\\
 t\_out\_pred\_6h & outdoor temperature predicted 6h ahead \\
 t\_out\_pred\_12h & outdoor temperature predicted 12h ahead \\
 t\_out\_pred\_24h & outdoor temperature predicted 24h ahead \\
 rh\_out & outdoor relative humidity in \%.\\
 rh\_out\_pred\_6h & outdoor relative humidity predicted 6h ahead \\
 rh\_out\_pred\_12h & outdoor relative humidity predicted 12h ahead \\
 rh\_out\_pred\_24h & outdoor relative humidity predicted 24h ahead \\
 diffuse\_solar\_rad & diffuse solar radiation in $W/m^2$.\\
 diffuse\_solar\_rad\_pred\_6h & diffuse solar radiation predicted 6h ahead \\
 diffuse\_solar\_rad\_pred\_12h & diffuse solar radiation predicted 12h ahead \\
 diffuse\_solar\_rad\_pred\_24h & diffuse solar radiation predicted 24h ahead \\
 direct\_solar\_rad & direct solar radiation in $W/m^2$. \\
 direct\_solar\_rad\_pred\_6h & direct solar radiation predicted 6h ahead \\ 
 direct\_solar\_rad\_pred\_12h & direct solar radiation predicted 12h ahead \\ 
 direct\_solar\_rad\_pred\_24h & direct solar radiation predicted 24h ahead \\ 
 wind\_speed & wind speed in $m/s$ \\
 wind\_speed\_pred\_6h & wind speed predicted 6h ahead \\
 wind\_speed\_pred\_12h & wind speed predicted 12h ahead \\
 wind\_speed\_pred\_24h & wind speed predicted 24h ahead \\
 non\_shiftable\_load & electricity currently consumed by electrical appliances in kWh.\\ 
 solar\_gen & electricity currently being generated by photovoltaic panels in kWh.\\ 
 electrical\_storage\_soc & SOC of the electrical storage from 0 (no energy stored) to 1 (at full capacity). \\
 net\_electricity\_consumption & net electricity consumption of the building (including all energy systems) in the current time step. \\
 electricity\_pricing & electricity rate in $\$/kWh$ \\
 electricity\_pricing\_pred\_6h & electricity rate predicted 6 hours ahead. \\
 electricity\_pricing\_pred\_12h & electricity rate predicted 12 hours ahead. \\
 electricity\_pricing\_pred\_24h & electricity rate predicted 24 hours ahead. \\
 renewable\_energy\_share & share of renewable energy in the fuel mix of the grid.
\end{tabularx}
\caption{Available state variables of the baseline SAC Agent}
\label{app:observation-space-sac}
\end{table}

\section{Figures}\label{sec:app-figures}
\begin{figure}[H]
    \center
     \includegraphics[width=\textwidth]{figures/building_daily_means.pdf}
  \caption{Daily means of the non-shiftable load and the solar generation of the buildings in kWh.}
  \label{app:building-daily-mean}
\end{figure}

\begin{figure}[H]
    \center
     \includegraphics[width=\textwidth]{figures/weather_daily_means.pdf}
  \caption{}
  \label{app:weather-daily-mean}
\end{figure}

\begin{figure}[H]
    \center
     \includegraphics[width=\textwidth]{figures/prb_ddpg_kpis.pdf}
  \caption{}
  \label{app:prb-ddpg-kpis}
\end{figure}


\section{Algorithms}\label{sec:app-algos}
\begin{algorithm}
\caption{\textcolor{red}{Social Agent I}}
\label{app:sac-social-1}
\small\textbf{Input:}   $\theta_1,\theta_2,\phi$ \Comment{\footnotesize Initial parameters}
\begin{algorithmic}[1]
\small \State $\bar{\theta}_1 \gets \theta_1, \bar{\theta}_2 \gets \theta_2$ \Comment{\footnotesize Initialize target network weights}
\small \State $\mathcal{D} \gets \emptyset$ \Comment{\footnotesize Initialize an empty replay buffer}
\small \For{each iteration}
	\small \For{each environment step}
		\small \State $\mathbf{a}_t \sim \pi_{\phi}(\mathbf{a}_t|\mathbf{s}_t)$ \Comment{\footnotesize Sample action from the policy}
		\small \State $\mathbf{s}_{t+1} \sim p(\mathbf{s}_{t+1}|\mathbf{s}_t,\mathbf{a}_t)$ \Comment{\footnotesize Sample next state from the environment}
		\small \State $\mathcal{D} \gets \mathcal{D} \cup \{(\mathbf{s}_t,\mathbf{a}_t,r(\mathbf{s}_t,\mathbf{a}_t),\mathbf{s}_{t+1})\}$ \Comment{\footnotesize Store the transition in the replay buffer}
	\small \EndFor
	\small \For{each gradient step}
		\small \State $\theta_i \gets \theta_i - \lambda_Q \hat{\triangledown}_{\theta_i}J_Q(\theta_i)$ for $i \in \{1,2\}$ \Comment{\footnotesize Update Q-function parameters}
		\small \State $\phi \gets \phi - \lambda _{\pi} \hat{\triangledown}_{\phi}J_{\pi}(\phi)$ \Comment{\footnotesize Update policy weights}
		\small \State $\alpha \gets \alpha - \lambda  \hat{\triangledown}_{\alpha}J(\alpha)$ \Comment{\footnotesize Adjust temperature}
		\small \State $\bar{\theta}_i \gets \tau\theta_i + (1-\tau)\bar{\theta}_i$ for $i \in \{1,2\}$ \Comment{\footnotesize Update target network weights}
		\small \For{each demonstrator $d$}
			\small \State $\mathbf{a}_t^d \sim \pi_{\phi}^d(\mathbf{a}_t^d|\mathbf{s}_t)$
			\small \State $\phi \gets \phi - \lambda _{\pi} \hat{\triangledown}_{\phi}J_{\pi}^{social}(\phi)$ \Comment{\footnotesize Social policy update}
		\small \EndFor
	\small \EndFor
\small \EndFor
\end{algorithmic}
\small \textbf{Output:}   $\theta_1,\theta_2,\phi$ \Comment{Optimized parameters}
\end{algorithm}

\begin{algorithm}
\caption{\textcolor{red}{Social Agent II}}
\label{app:sac-social-2}
\small\textbf{Input:}   $\theta_1,\theta_2,\phi$ \Comment{\footnotesize Initial parameters}
\begin{algorithmic}[1]
\small \State $\bar{\theta}_1 \gets \theta_1, \bar{\theta}_2 \gets \theta_2$ \Comment{\footnotesize Initialize target network weights}
\small \State $\mathcal{D} \gets \emptyset$ \Comment{\footnotesize Initialize an empty replay buffer}
\small \For{each iteration}
	\small \For{each environment step}
		\small \State $\mathbf{a}_t \sim \pi_{\phi}(\mathbf{a}_t|\mathbf{s}_t)$ \Comment{\footnotesize Sample action from the policy}
		\small \State $\mathbf{s}_{t+1} \sim p(\mathbf{s}_{t+1}|\mathbf{s}_t,\mathbf{a}_t)$ \Comment{\footnotesize Sample next state from the environment}
		\small \State $\mathcal{D} \gets \mathcal{D} \cup \{(\mathbf{s}_t,\mathbf{a}_t,r(\mathbf{s}_t,\mathbf{a}_t),\mathbf{s}_{t+1})\}$ \Comment{\footnotesize Store the transition in the replay buffer}
	\small \EndFor
	\small \For{each gradient step}
		\small \State $\theta_i \gets \theta_i - \lambda_Q \hat{\triangledown}_{\theta_i}J_Q(\theta_i)$ for $i \in \{1,2\}$ \Comment{\footnotesize Update Q-function parameters}
		\small \State $\phi \gets \phi - \lambda _{\pi} \hat{\triangledown}_{\phi}J_{\pi}(\phi)$ \Comment{\footnotesize Update policy weights}
		\small \State $\alpha \gets \alpha - \lambda  \hat{\triangledown}_{\alpha}J(\alpha)$ \Comment{\footnotesize Adjust temperature}
		\small \State $\bar{\theta}_i \gets \tau\theta_i + (1-\tau)\bar{\theta}_i$ for $i \in \{1,2\}$ \Comment{\footnotesize Update target network weights}
		\small \For{each demonstrator $d$}
			\small \State $\theta_i \gets \theta_i - \lambda_Q \hat{\triangledown}_{\theta_i}J_Q^{social}(\theta_i)$ for $i \in \{1,2\}$ \Comment{\footnotesize Social Q-function update}
			\small \State $\bar{\theta}_i \gets \tau\theta_i + (1-\tau)\bar{\theta}_i$ for $i \in \{1,2\}$ \Comment{\footnotesize Update target network weights}
			\small \If{extra policy update}
				\small \State $\phi \gets \phi - \lambda _{\pi} \hat{\triangledown}_{\phi}J_{\pi}(\phi)$ \Comment{\footnotesize Update policy weights}
			\small \EndIf
		\small \EndFor
	\small \EndFor
\small \EndFor
\end{algorithmic}
\small \textbf{Output:}   $\theta_1,\theta_2,\phi$ \Comment{Optimized parameters}
\end{algorithm}

%\end{appendices)
